# üóÑÔ∏è Backend & Database - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å 4 —Ñ–∞–π–ª–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ backend:

1. **[BACKEND_CHOOSE.md](BACKEND_CHOOSE.md)** - –í—ã–±–æ—Ä –º–µ–∂–¥—É SQLite/PostgreSQL/MongoDB/Firebase
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É
   - –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ

2. **[BACKEND_QUICK_SETUP.md](BACKEND_QUICK_SETUP.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (15 –º–∏–Ω)
   - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
   - –ß–µ–∫-–ª–∏—Å—Ç –≤—Å–µ—Ö —à–∞–≥–æ–≤
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

3. **[BACKEND_SETUP.md](BACKEND_SETUP.md)** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
   - –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ë–î
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ API routes
   - –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma schema)
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

4. **[BACKEND_EXAMPLES.ts](BACKEND_EXAMPLES.ts)** - –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
   - –°–∫–æ–ø–∏—Ä—É–π-–≤—Å—Ç–∞–≤—å –∫–æ–¥
   - –í—Å–µ API routes
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

### –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–±–æ—Ç–∞—é—â—É—é –ë–î:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (30 —Å–µ–∫)
npm install @prisma/client prisma bcryptjs

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (20 —Å–µ–∫)
npx prisma init

# 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (20 —Å–µ–∫)
# –û—Ç–∫—Ä–æ–π .env.local –∏ –∑–∞–º–µ–Ω–∏ –Ω–∞:
DATABASE_URL="file:./dev.db"

# 4. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã (1 –º–∏–Ω)
# –°–∫–æ–ø–∏—Ä—É–π –∏–∑ BACKEND_SETUP.md –≤–µ—Å—å prisma/schema.prisma
# –ó–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ prisma/schema.prisma

# 5. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î (1 –º–∏–Ω)
npx prisma migrate dev --name init

# 6. –ì–æ—Ç–æ–≤–æ! –ó–∞–ø—É—Å–∫:
npm run dev
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** SQLite –ë–î —Å 4 —Ç–∞–±–ª–∏—Ü–∞–º–∏ (User, Schedule, Booking, Review)

---

## üó∫Ô∏è –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–±–µ–∑ –ë–î)

- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock –¥–∞–Ω–Ω—ã–µ –∏–∑ `contexts/AuthContext.tsx`
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö changes –Ω–µ –Ω—É–∂–Ω—ã
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –¥–µ–º–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –•–æ—á—É –ë–î –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- ‚úÖ –°–ª–µ–¥—É–π [BACKEND_QUICK_SETUP.md](BACKEND_QUICK_SETUP.md)
- ‚úÖ –≠—Ç–æ –∑–∞–π–º–µ—Ç 15 –º–∏–Ω—É—Ç
- ‚úÖ SQLite –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Production —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

- ‚úÖ –ù–∞—á–Ω–∏ —Å SQLite
- ‚úÖ –ü–æ—Ç–æ–º –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Å—å –Ω–∞ PostgreSQL
- ‚úÖ [BACKEND_CHOOSE.md](BACKEND_CHOOSE.md) –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

```json
{
  "id": "abc123",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "email": "ivan@example.com",
  "phone": "+7 (900) 123-45-67",
  "role": "user",
  "createdAt": "2024-01-15T10:00:00Z"
}
```

### Schedule (–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–π—Å–æ–≤)

```json
{
  "id": "sch123",
  "from": "–ò—Ä–∫—É—Ç—Å–∫",
  "to": "–û–ª—å—Ö–æ–Ω",
  "departureTime": "2024-01-15T08:00:00Z",
  "arrivalTime": "2024-01-15T12:30:00Z",
  "driverName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "price": 250000,
  "capacity": 45,
  "amenities": "wifi,toilet,ac"
}
```

### Booking (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

```json
{
  "id": "bk123",
  "userId": "abc123",
  "scheduleId": "sch123",
  "passengers": 2,
  "totalPrice": 500000,
  "status": "confirmed",
  "bookingNumber": "BK123456",
  "paymentMethod": "card"
}
```

### Review (–û—Ç–∑—ã–≤—ã)

```json
{
  "id": "rev123",
  "userId": "abc123",
  "scheduleId": "sch123",
  "rating": 5,
  "comment": "–û—Ç–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å!"
}
```

---

## üîó API Endpoints (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

```
POST   /api/auth/register        - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /api/auth/login           - –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/schedules            - –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ñ–∏–ª—å—Ç—Ä—ã: ?from=&to=)
POST   /api/schedules            - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–∞–¥–º–∏–Ω)
GET    /api/bookings             - –ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (?userId=)
POST   /api/bookings             - –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ë–î –≤ –∫—Ä–∞—Å–∏–≤–æ–º UI
npx prisma studio

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è schema
npx prisma migrate dev --name "–Ω–∞–∑–≤–∞–Ω–∏–µ"

# –°–±—Ä–æ—Å–∏—Ç—å –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ - —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
npx prisma migrate reset

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã TypeScript
npx prisma generate

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate status
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –ü—Ä–æ—á–∏—Ç–∞–ª [BACKEND_CHOOSE.md](BACKEND_CHOOSE.md)
- [ ] –í—ã–±—Ä–∞–ª SQLite –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏–ª `npm install @prisma/client prisma bcryptjs`
- [ ] –í—ã–ø–æ–ª–Ω–∏–ª `npx prisma init`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–ª —Å—Ö–µ–º—É –≤ `prisma/schema.prisma`
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏–ª `DATABASE_URL="file:./dev.db"` –≤ `.env.local`
- [ ] –°–æ–∑–¥–∞–ª –ë–î: `npx prisma migrate dev --name init`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–ª API routes –∏–∑ [BACKEND_EXAMPLES.ts](BACKEND_EXAMPLES.ts)
- [ ] –û–±–Ω–æ–≤–∏–ª `contexts/AuthContext.tsx`
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª `npm run dev`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –Ω–∞ http://localhost:3001/bus/register

---

## üö® –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### "Cannot find module '@prisma/client'"

```bash
npm install @prisma/client
npx prisma generate
```

### "Database dev.db is locked"

```bash
# –ó–∞–∫—Ä–æ–π –≤—Å–µ Node.js –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –∑–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞
rm -rf .next
npm run dev
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ schema.prisma
npx prisma validate

# –°–±—Ä–æ—Å –ë–î (—É–¥–∞–ª–∏—Ç –≤—Å–µ!)
npx prisma migrate reset
```

### –ù–µ –≤–∏–∂—É –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

```bash
# –û—Ç–∫—Ä–æ–π Prisma Studio
npx prisma studio

# –ë—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ http://localhost:5555
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏:

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π:**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π `bcryptjs` (—É–∂–µ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö)
   - ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–π –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - ‚úÖ –ü–æ–º–µ—Å—Ç–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `.env.local`
   - ‚ùå –ù–ï –∫–æ–º–º–∏—Ç–∏—Ä—É–π `.env.local` –≤ git

3. **–î–ª—è production:**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π HTTPS –≤–µ–∑–¥–µ
   - ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–π –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π JWT —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ sessions
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–π CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å:

1. **SQLite ‚Üí PostgreSQL** (–∫–æ–≥–¥–∞ ~100+ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
2. **–î–æ–±–∞–≤–∏—Ç—å Redis** –¥–ª—è –∫—ç—à–∞
3. **–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã** (–∫–æ–≥–¥–∞ >1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **Prisma –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://www.prisma.io/docs
- **Next.js API Routes:** https://nextjs.org/docs/app/building-your-application/routing/route-handlers
- **PostgreSQL:** https://www.postgresql.org/docs
- **Firebase:** https://firebase.google.com/docs
- **MongoDB:** https://docs.mongodb.com

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

–ü–æ—Å–ª–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —ç—Ç–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:

- ‚úÖ –£ —Ç–µ–±—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–∞—è –ë–î
- ‚úÖ API routes –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–ª—è—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏

**–ì–æ—Ç–æ–≤–æ –¥–ª—è production? ‚Üí [BACKEND_CHOOSE.md](BACKEND_CHOOSE.md)**

---

_–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –∏ –Ω–∞—á–Ω–∏!_ üöÄ
